(()=>{"use strict";var e={528:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={admin:!0,port:8080}},21:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function d(e){try{u(o.next(e))}catch(e){n(e)}}function a(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(d,a)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(r(147)),d=i(r(17)),a=r(828),u=i(r(255)),{getById:s}=u.default,c=d.default.resolve(__dirname,"../carts.json"),l=()=>o(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.readFile(c,"utf-8").then((e=>JSON.parse(e))).then((e=>e))}catch(e){return{Err:`Algo salio mal al traer todos los cart ${e}`}}})),f=e=>o(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.readFile(c,"utf-8").then((e=>JSON.parse(e))).then((t=>t.find((t=>t.id==e))))}catch(e){return{Err:`Algo salio mal al buscar cart por ID, error: ${e}`}}}));t.default={getCartById:f,createCart:()=>o(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.readFile(c,"utf-8").then((e=>JSON.parse(e))).then((e=>o(void 0,void 0,void 0,(function*(){const t={id:(0,a.v4)(),timestamp:(new Date).getDay()+"/"+(new Date).getMonth()+", "+(new Date).getHours()+":"+(new Date).getMinutes()+"hs",products:[]};e.push(t);try{return yield n.default.promises.writeFile(c,JSON.stringify(e)).then((()=>`Se creo tu cart con ID: ${t.id}`))}catch(e){return{Err:`Algo salio mal al sobreescribir el archivo, error: ${e}`}}}))))}catch(e){return{Err:`Algo salio mal al guardar el archivo, error: ${e}`}}})),deleteCartById:e=>o(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.readFile(c,"utf-8").then((e=>JSON.parse(e))).then((t=>o(void 0,void 0,void 0,(function*(){const r=t.filter((t=>t.id!=e));try{return yield n.default.promises.writeFile(c,JSON.stringify(r)).then((()=>`Se borro tu cart con ID ${e}`))}catch(e){return{Err:`Algo salio mal al eliminar el producto, error: ${e}`}}}))))}catch(e){return{Err:`Algo salio mal al buscar el producto a eliminar, error: ${e}`}}})),reqBodyCheck:e=>o(void 0,void 0,void 0,(function*(){return e.body.productId?void 0:"Por favor completa el campo 'productId' en el body para añadir ese producto al carrito."})),addProdToCart:(e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield l(),o=yield f(e),i=yield s(t);if(null==o.products)return"Ese ID no pertenece a ningun cart.";if(!i)return"Ese ID no pertenece a ningun producto.";{const t=r.map((e=>e.id)).indexOf(e),d=o.products;d.push(i),o.products=d,r[t]=o;try{return yield n.default.promises.writeFile(c,JSON.stringify(r)).then((()=>`Se añadio ${i.title} a tu cart con ID: ${o.id}`))}catch(e){return{Err:`Algo salio mal al sobreescribir el archivo, error: ${e}`}}}})),deleteProdFromCart:(e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield l(),o=yield f(e),i=yield s(t);if(null==o.products)return"Ese ID no pertenece a ningun cart.";if(!i)return"Ese ID no pertenece a ningun producto.";{const t=o.products.filter((e=>e.id!=i.id));o.products=t;const d=r.map((e=>e.id)).indexOf(e);r[d]=o;try{return yield n.default.promises.writeFile(c,JSON.stringify(r)).then((()=>`Se elimino ${i.title} de tu cart con ID: ${o.id}`))}catch(e){return{Err:`Algo salio mal al sobreescribir el archivo, error: ${e}`}}}}))}},255:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function d(e){try{u(o.next(e))}catch(e){n(e)}}function a(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(d,a)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(r(147)),d=i(r(17)),a=r(828),u=d.default.resolve(__dirname,"../products.json"),s=()=>o(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.readFile(u,"utf-8").then((e=>JSON.parse(e)))}catch(e){return"SyntaxError: Unexpected end of JSON input"==e?(yield n.default.promises.writeFile(u,"[]"),[]):(console.log(u),{Err:`Error en la lectura del archivo error: ${e}`})}}));t.default={getAll:s,getById:e=>o(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.readFile(u,"utf-8").then((e=>JSON.parse(e))).then((t=>t.find((t=>t.id==e))))}catch(e){return{Err:`Algo salio mal al buscar por ID, error: ${e}`}}})),save:e=>o(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.readFile(u,"utf-8").then((e=>JSON.parse(e))).then((t=>o(void 0,void 0,void 0,(function*(){e.id=(0,a.v4)(),e.timestamp=(new Date).getDay()+"/"+(new Date).getMonth()+", "+(new Date).getHours()+":"+(new Date).getMinutes()+"hs",t.push(e);try{return yield n.default.promises.writeFile(u,JSON.stringify(t)).then((()=>e.id))}catch(e){return{Err:`Algo salio mal al sobreescribir el archivo, error: ${e}`}}}))))}catch(e){return{Err:`Algo salio mal al guardar el archivo, error: ${e}`}}})),update:(e,t)=>o(void 0,void 0,void 0,(function*(){e.id=t.id;const r=yield s(),o=r.findIndex((e=>e.id==t.id));r[o]=e;try{return yield n.default.promises.writeFile(u,JSON.stringify(r)).then((()=>e.id))}catch(e){return{Err:`Algo salio mal al sobreescribir el archivo, error: ${e}`}}})),deleteById:e=>o(void 0,void 0,void 0,(function*(){try{return yield n.default.promises.readFile(u,"utf-8").then((e=>JSON.parse(e))).then((t=>o(void 0,void 0,void 0,(function*(){const r=t.filter((t=>t.id!=e));try{return yield n.default.promises.writeFile(u,JSON.stringify(r)).then((()=>e))}catch(e){return{Err:`Algo salio mal al eliminar el producto, error: ${e}`}}}))))}catch(e){return{Err:`Algo salio mal al buscar el producto a eliminar, error: ${e}`}}})),requestInputCheck:e=>o(void 0,void 0,void 0,(function*(){return e.body.title&&e.body.price&&e.body.thumbnail&&e.body.stock&&e.body.description?isNaN(e.body.price)||isNaN(e.body.stock)?"Los campos 'price' y 'stock' debe ser un numero.":void 0:"Por favor completa los campos 'title', 'price', 'thumbnail', 'stock' y 'description'."})),requestParamCheck:e=>o(void 0,void 0,void 0,(function*(){return e.params.id?void 0:"Se requiere un ID del producto a modificar."}))}},607:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(r(669)),n=o(r(528));i.default.listen(n.default.port,(()=>{console.log(`listening ${n.default.port}`)}))},343:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkAdmin=void 0;const i=o(r(528));t.checkAdmin=(e,t,r)=>{if(!i.default.admin)return t.status(401).json({err:-1,msg:"No estas autorizado."});r()}},206:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function d(e){try{u(o.next(e))}catch(e){n(e)}}function a(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(d,a)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(860),d=i(r(21)),{getCartById:a,createCart:u,deleteCartById:s,reqBodyCheck:c,addProdToCart:l,deleteProdFromCart:f}=d.default,p=(0,n.Router)();p.get("/:cartId/products",((e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield a(e.params.cartId);r?t.send(r.products):t.status(404).json({Err:`Ningun carrito tiene id: ${e.params.cartId}`})})))),p.post("/",((e,t)=>o(void 0,void 0,void 0,(function*(){const e=yield u();t.send(e)})))),p.post("/:cartId/products",((e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield c(e),o=yield l(e.params.cartId,e.body.productId);r?t.send(r):t.send(o)})))),p.delete("/:cartId",((e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield s(e.params.cartId);t.send(r)})))),p.delete("/:cartId/products/:prodId",((e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield f(e.params.cartId,e.params.prodId);t.send(r)})))),t.default=p},459:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(860),n=o(r(208)),d=o(r(206)),a=(0,i.Router)();a.use("/products",n.default),a.use("/carts",d.default),t.default=a},208:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function d(e){try{u(o.next(e))}catch(e){n(e)}}function a(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(d,a)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(860),d=i(r(255)),a=r(343),{getAll:u,getById:s,save:c,update:l,deleteById:f,requestInputCheck:p,requestParamCheck:v}=d.default,y=(0,n.Router)();y.get("/",((e,t)=>o(void 0,void 0,void 0,(function*(){const e=yield u();t.send(e)})))),y.get("/:id",((e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield v(e),o=yield s(e.params.id);r?t.status(400).json({Err:r}):o?t.send(o):t.status(404).json({Err:`Ninguno de los productos tiene id: ${e.params.id}`})})))),y.post("/",a.checkAdmin,((e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield p(e);r?t.status(400).json({err:r}):t.send(`Se guardo tu producto: ${JSON.stringify(e.body)} con id ${yield c(e.body)}`)})))),y.put("/:id",a.checkAdmin,((e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield p(e),o=yield v(e),i=yield s(e.params.id);r?t.status(400).json({ErrBody:r}):o?t.status(400).json({ErrParam:o}):i?t.send(`Se guardaron los siguientes cambios: ${JSON.stringify(e.body)} \n En tu producto con ID ${yield l(e.body,i)}`):t.send(`Se creo tu producto: ${JSON.stringify(e.body)} con id ${yield c(e.body)}`)})))),y.delete("/:id",a.checkAdmin,((e,t)=>o(void 0,void 0,void 0,(function*(){const r=yield v(e),o=yield f(e.params.id);r?t.status(400).json({ErrParam:r}):t.send(`Se elimino tu producto con ID ${o} `)})))),t.default=y},669:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(r(860)),n=o(r(459)),d=(0,i.default)();d.use(i.default.json()),d.use(i.default.urlencoded({extended:!0})),d.use(i.default.static("public")),d.use("/api",n.default),t.default=d},860:e=>{e.exports=require("express")},828:e=>{e.exports=require("uuid")},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")}},t={};!function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}(607)})();