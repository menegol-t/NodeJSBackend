(()=>{var e={607:function(e,t,s){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(s(669)),n=a(s(330)),o=new n.default("messages");new n.default("products").innit(),o.innit(),i.default.listen(8080,(()=>{console.log("listening 8080")}))},497:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestParamCheck=t.requestInputCheck=void 0,t.requestInputCheck=(e,t,s)=>e.body.title&&e.body.price&&e.body.thumbnail?isNaN(e.body.price)||isNaN(e.body.stock)?t.status(401).json({msg:"Los campos 'price' y 'stock' debe ser un numero."}):void s():t.status(401).json({msg:"Por favor completa los campos 'title', 'price', 'thumbnail', 'stock' y 'description'."}),t.requestParamCheck=(e,t,s)=>{if(!e.params.id)return t.status(401).json({msg:"Se requiere un ID del producto a modificar."});s()}},578:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dbConfig=void 0,t.dbConfig={messages:{client:"sqlite3",connection:{filename:"ecommerse.sqlite"},useNullAsDefault:!0},products:{client:"mysql",connection:{host:"localhost",user:"root",password:"",port:3306,database:"sqldb"}}}},459:function(e,t,s){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(860),n=a(s(208)),o=(0,i.Router)();o.use("/products",n.default),t.default=o},208:function(e,t,s){"use strict";var a=this&&this.__awaiter||function(e,t,s,a){return new(s||(s=Promise))((function(i,n){function o(e){try{u(a.next(e))}catch(e){n(e)}}function r(e){try{u(a.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}u((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=s(860),n=s(330),o=s(497),r=(0,i.Router)(),u=new n("products");r.get("/",((e,t)=>a(void 0,void 0,void 0,(function*(){t.redirect("/")})))),r.get("/:id",o.requestParamCheck,((e,t)=>a(void 0,void 0,void 0,(function*(){t.send(yield u.get(e.params.id))})))),r.post("/",o.requestInputCheck,((e,t)=>a(void 0,void 0,void 0,(function*(){const s=e.body;yield u.save(s).then((()=>t.redirect("api/products")))})))),r.put("/:id",o.requestInputCheck,o.requestParamCheck,((e,t)=>a(void 0,void 0,void 0,(function*(){t.send(yield u.update(e.params.id,e.body))})))),r.delete("/:id",o.requestParamCheck,((e,t)=>a(void 0,void 0,void 0,(function*(){yield u.delete(e.params.id),t.send(`Se elimino el producto ${e.params.id}`)})))),t.default=r},669:function(e,t,s){"use strict";var a=this&&this.__awaiter||function(e,t,s,a){return new(s||(s=Promise))((function(i,n){function o(e){try{u(a.next(e))}catch(e){n(e)}}function r(e){try{u(a.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}u((a=a.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(s(860)),o=i(s(17)),r=i(s(459)),u=s(328),c=s(330),d=new c("messages"),l=new c("products"),h=s(685),p=(0,n.default)(),f=o.default.resolve(__dirname,"../../views"),b=h.Server(p);p.use(n.default.static("public")),p.use(n.default.json()),p.use(n.default.urlencoded({extended:!0})),p.use("/api",r.default),p.set("views",f),p.set("view engine","pug"),p.get("/",((e,t)=>a(void 0,void 0,void 0,(function*(){t.render("index.pug",{allData:yield l.get(),msgs:yield d.get()})})))),u(b),t.default=b},330:(e,t,s)=>{const a=s(514),{dbConfig:i}=s(578);e.exports=class{constructor(e){const t=i[`${e}`];this.knex=a(t),this.database=e}async innit(){"messages"==this.database?await this.knex.schema.hasTable("messages").then((e=>e?console.log(`Tabla ${this.database} ya creada en ${i[`${this.database}`].client}`):this.knex.schema.createTable("messages",(async e=>{e.increments(),e.string("email").notNullable(),e.string("message").notNullable(),e.string("timestamp").notNullable(),console.log(`Se creo la Tabla ${this.database} en base de datos ${i[`${this.database}`].client} `)})))):"products"==this.database?await this.knex.schema.hasTable("products").then((e=>e?console.log(`Tabla ${this.database} ya creada en ${i[`${this.database}`].client}`):this.knex.schema.createTable("products",(async e=>{e.increments(),e.string("title").notNullable(),e.integer("price").notNullable(),e.string("thumbnail").notNullable(),console.log(`Se creo la Tabla ${this.database} en base de datos ${i[`${this.database}`].client} `)})))):console.log("Por favor selecciona una base de datos valida")}async get(e){return e?await this.knex(this.database).where("id",e):await this.knex(this.database)}async save(e){const t=await this.knex(this.database).insert(e);return e.id=t[0],await e}async update(e,t){return await this.knex(this.database).where("id",e).update(t)}async delete(e){return await this.knex(this.database).where("id",e).del()}}},328:(e,t,s)=>{const a=s(952),i=s(330);let n;const o=new i("messages"),r=new i("products");e.exports=e=>{n=a(e),n.on("connection",(async e=>{e.on("postProduct",(async e=>{n.emit("addToProdList",await r.save(e))})),e.on("postMsgToChat",(async e=>{n.emit("addToChatList",await o.save(e))}))}))}},860:e=>{"use strict";e.exports=require("express")},514:e=>{"use strict";e.exports=require("knex")},952:e=>{"use strict";e.exports=require("socket.io")},685:e=>{"use strict";e.exports=require("http")},17:e=>{"use strict";e.exports=require("path")}},t={};!function s(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,s),n.exports}(607)})();