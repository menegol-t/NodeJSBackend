(()=>{"use strict";var e={528:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={admin:!0}},21:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,d){function c(e){try{s(r.next(e))}catch(e){d(e)}}function i(e){try{s(r.throw(e))}catch(e){d(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,i)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProdFromCart=t.addProdToCart=t.deleteCartById=t.createCart=t.getProdsInsideCartId=t.getCartById=t.getAllCarts=void 0;const n=o(820),d=o(25);t.getAllCarts=(e,t,o)=>r(void 0,void 0,void 0,(function*(){try{const e=yield n.CartModel.find();t.send(e)}catch(e){e instanceof Error?t.status(500).json({msg:"Get all carts error",error:e}):o(e)}})),t.getCartById=(e,t,o)=>r(void 0,void 0,void 0,(function*(){try{const{cartId:o}=e.params,r=yield n.CartModel.findById(o);if(r)return r;t.status(400).json({msg:"No se encontro ningun cart con ese ID"})}catch(e){e instanceof Error?t.status(500).json({msg:"Get cart by id error",error:e}):o(e)}})),t.getProdsInsideCartId=(e,o,n)=>r(void 0,void 0,void 0,(function*(){try{const r=yield(0,t.getCartById)(e,o,n);o.send(r.products)}catch(e){e instanceof Error?o.status(500).json({msg:"Get products in cart error",error:e}):n(e)}})),t.createCart=(e,t,o)=>r(void 0,void 0,void 0,(function*(){try{const e=yield n.CartModel.create({products:[]});t.send(`Cart created: ${e}`)}catch(e){e instanceof Error?t.status(500).json({msg:"Create cart error",error:e}):o(e)}})),t.deleteCartById=(e,t,o)=>r(void 0,void 0,void 0,(function*(){try{const{cartId:o}=e.params;yield n.CartModel.findByIdAndDelete(o),t.send(`Cart with ID ${o} deleted.`)}catch(e){e instanceof Error?t.status(500).json({msg:"Delete cart error",error:e}):o(e)}})),t.addProdToCart=(e,o,c)=>r(void 0,void 0,void 0,(function*(){try{const{productId:r}=e.body,i=yield d.ProductsModel.findById(r),s=yield(0,t.getCartById)(e,o,c),{products:a}=s,{cartId:u}=e.params;if(i)if(s){a.push(i);const e=yield n.CartModel.findByIdAndUpdate(u,{products:a},{new:!0});o.send(`Cart changed: ${e}`)}else o.status(400).json({msg:"No se encontro ningun cart con ese ID"});else o.status(400).json({msg:"No se encontro ningun producto con ese ID"})}catch(e){e instanceof Error?o.status(500).json({msg:"Add product to cart error",error:e}):c(e)}})),t.deleteProdFromCart=(e,o,c)=>r(void 0,void 0,void 0,(function*(){try{const{productId:r}=e.body,i=yield d.ProductsModel.findById(r),s=yield(0,t.getCartById)(e,o,c),{products:a}=s,{cartId:u}=e.params;if(i)if(s){!function(e,t){const o=e.findIndex((e=>e._id==t));o>-1&&e.splice(o,1)}(a,r);const e=yield n.CartModel.findByIdAndUpdate(u,{products:a},{new:!0});o.send(`Cart changed: ${e}`)}else o.status(400).json({msg:"No se encontro ningun cart con ese ID"});else o.status(400).json({msg:"Ese producto no esta en el carro"})}catch(e){e instanceof Error?o.status(500).json({msg:"Delete product from cart error",error:e}):c(e)}}))},255:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,d){function c(e){try{s(r.next(e))}catch(e){d(e)}}function i(e){try{s(r.throw(e))}catch(e){d(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,i)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProd=t.updateProd=t.saveProd=t.getProdById=t.getAllProd=void 0;const n=o(25);t.getAllProd=(e,t,o)=>r(void 0,void 0,void 0,(function*(){try{const e=yield n.ProductsModel.find();t.send(e)}catch(e){e instanceof Error?t.status(500).json({msg:"Get all products Error",error:e}):o(e)}})),t.getProdById=(e,t,o)=>r(void 0,void 0,void 0,(function*(){try{const{productId:o}=e.params,r=yield n.ProductsModel.findById(o);r?t.send(r):t.status(400).json({msg:"No se encontro ningun producto con ese ID"})}catch(e){e instanceof Error?t.status(500).json({msg:"Get product by ID error",error:e}):o(e)}})),t.saveProd=(e,t,o)=>r(void 0,void 0,void 0,(function*(){try{const{title:o,price:r,thumbnail:d,stock:c,description:i}=e.body,s=yield n.ProductsModel.create({title:o,price:r,thumbnail:d,stock:c,description:i});t.send(`Succesfully saved ${s}`)}catch(e){e instanceof Error?t.status(500).json({msg:"Save product error",error:e}):o(e)}})),t.updateProd=(e,t,o)=>r(void 0,void 0,void 0,(function*(){try{const{productId:o}=e.params,r={};for(let[t,o]of Object.entries(e.body))void 0!==o&&(r[t]=o);const d=yield n.ProductsModel.findByIdAndUpdate(o,r,{new:!0});t.send(`Update succesful: ${d}`)}catch(e){e instanceof Error?t.status(500).json({msg:"Update product error",error:e}):o(e)}})),t.deleteProd=(e,t,o)=>r(void 0,void 0,void 0,(function*(){try{const{productId:o}=e.params;yield n.ProductsModel.findByIdAndDelete(o),t.send(`Product with ID ${o} deleted`)}catch(e){e instanceof Error?t.status(500).json({msg:"Delete product error",error:e}):o(e)}}))},607:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,d){function c(e){try{s(r.next(e))}catch(e){d(e)}}function i(e){try{s(r.throw(e))}catch(e){d(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,i)}s((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),o(81);const d=n(o(669)),c=o(611);r(void 0,void 0,void 0,(function*(){yield(0,c.innitMongo)(),d.default.listen(8080,(()=>console.log("Listening 8080")))}))},343:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkAdmin=void 0;const n=r(o(528));t.checkAdmin=(e,t,o)=>{if(!n.default.admin)return t.status(401).json({err:-1,msg:"No estas autorizado."});o()}},287:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,d){function c(e){try{s(r.next(e))}catch(e){d(e)}}function i(e){try{s(r.throw(e))}catch(e){d(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,i)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.reqBodyUpdateCheck=t.reqBody_ProdIdCheck=t.requestParamCheck=t.requestBodyCheck=void 0,t.requestBodyCheck=(e,t,r)=>o(void 0,void 0,void 0,(function*(){return e.body.title&&e.body.price&&e.body.thumbnail&&e.body.stock&&e.body.description?isNaN(e.body.price)||isNaN(e.body.stock)?t.status(401).json({Error:"Los campos 'price' y 'stock' debe ser un numero."}):void r():t.status(401).json({Error:"Por favor completa los campos 'title', 'price', 'thumbnail', 'stock' y 'description'."})})),t.requestParamCheck=(e,t,r)=>o(void 0,void 0,void 0,(function*(){if(!e.params.productId)return t.status(401).json({Error:"Se requiere un ID del producto."});r()})),t.reqBody_ProdIdCheck=(e,t,r)=>o(void 0,void 0,void 0,(function*(){if(!e.body.productId)return t.status(401).json({Error:"Por favor completa el campo 'productId' en el body para aÃ±adir o eliminar ese producto del carrito."});r()})),t.reqBodyUpdateCheck=(e,t,r)=>o(void 0,void 0,void 0,(function*(){return e.body.price&&isNaN(e.body.price)?t.status(401).json({Error:"El campo 'price' debe ser un numero."}):e.body.stock&&isNaN(e.body.stock)?t.status(401).json({Error:"El campo 'stock' debe ser un numero."}):void r()}))},820:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CartModel=t.cartCollection=void 0;const n=r(o(185));t.cartCollection="cart";const d=new n.default.Schema({products:{type:[],required:!0}},{timestamps:!0,versionKey:!1});t.CartModel=n.default.model(t.cartCollection,d)},25:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProductsModel=void 0;const n=r(o(185)),d=new n.default.Schema({title:{type:String,required:!0,maxlength:2},price:{type:Number,required:!0,max:50},thumbnail:{type:String,required:!0},stock:{type:Number,required:!0,max:50},description:{type:String,required:!0,max:500}},{timestamps:!0,versionKey:!1});t.ProductsModel=n.default.model("product",d)},206:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,d){function c(e){try{s(r.next(e))}catch(e){d(e)}}function i(e){try{s(r.throw(e))}catch(e){d(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,i)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=o(860),d=o(287),c=o(21),i=(0,n.Router)();i.get("/",c.getAllCarts),i.get("/:cartId",((e,t,o)=>r(void 0,void 0,void 0,(function*(){const r=yield(0,c.getCartById)(e,t,o);t.send(r)})))),i.get("/:cartId/products",c.getProdsInsideCartId),i.post("/",c.createCart),i.post("/:cartId/products",d.reqBody_ProdIdCheck,c.addProdToCart),i.delete("/:cartId",c.deleteCartById),i.delete("/:cartId/products/",d.reqBody_ProdIdCheck,c.deleteProdFromCart),t.default=i},459:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=o(860),d=r(o(208)),c=r(o(206)),i=(0,n.Router)();i.use("/products",d.default),i.use("/carts",c.default),t.default=i},208:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(860),n=o(287),d=o(255),c=o(343),i=(0,r.Router)();i.get("/",d.getAllProd),i.get("/:productId",n.requestParamCheck,d.getProdById),i.post("/",c.checkAdmin,n.requestBodyCheck,d.saveProd),i.put("/:productId",c.checkAdmin,n.requestParamCheck,n.reqBodyUpdateCheck,d.updateProd),i.delete("/:productId",c.checkAdmin,n.requestParamCheck,d.deleteProd),t.default=i},611:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,d){function c(e){try{s(r.next(e))}catch(e){d(e)}}function i(e){try{s(r.throw(e))}catch(e){d(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,i)}s((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.innitMongo=void 0;const d=n(o(185)),c=process.env.MONGO_ATLAS_SRV||"mongodb://localhost:27017/miDatabase";t.innitMongo=()=>r(void 0,void 0,void 0,(function*(){try{console.log("Conecting to mongo"),yield d.default.connect(c),console.log("Connected")}catch(e){return console.log("Error"),console.log(e),e}}))},669:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(o(860)),d=r(o(459)),c=r(o(685)),i=(0,n.default)();i.use(n.default.static("public")),i.use(n.default.json()),i.use(n.default.urlencoded({extended:!0})),i.use("/api",d.default),i.use(((e,t,o,r)=>o.status(500).json({msg:"Unexpected error",error:e})));const s=new c.default.Server(i);t.default=s},81:e=>{e.exports=require("dotenv/config")},860:e=>{e.exports=require("express")},185:e=>{e.exports=require("mongoose")},685:e=>{e.exports=require("http")}},t={};!function o(r){var n=t[r];if(void 0!==n)return n.exports;var d=t[r]={exports:{}};return e[r].call(d.exports,d,d.exports,o),d.exports}(607)})();